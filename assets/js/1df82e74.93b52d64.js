"use strict";(self.webpackChunkgo_eagle_org_3=self.webpackChunkgo_eagle_org_3||[]).push([[9840],{7300:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>i,contentTitle:()=>d,default:()=>p,frontMatter:()=>o,metadata:()=>n,toc:()=>t});const n=JSON.parse('{"id":"deployment/app-deploy","title":"\u5e94\u7528\u90e8\u7f72","description":"Eagle \u4e00\u5957\u8f7b\u91cf\u7ea7 Go \u5fae\u670d\u52a1\u6846\u67b6\uff0c\u5305\u542b\u5927\u91cf\u5fae\u670d\u52a1\u76f8\u5173\u6846\u67b6\u53ca\u5de5\u5177","source":"@site/docs/deployment/app-deploy.md","sourceDirName":"deployment","slug":"/deployment/app-deploy","permalink":"/docs/deployment/app-deploy","draft":false,"unlisted":false,"editUrl":"https://github.com/go-eagle/go-eagle.org/edit/main/docs/deployment/app-deploy.md","tags":[],"version":"current","frontMatter":{"id":"app-deploy","title":"\u5e94\u7528\u90e8\u7f72","description":"Eagle \u4e00\u5957\u8f7b\u91cf\u7ea7 Go \u5fae\u670d\u52a1\u6846\u67b6\uff0c\u5305\u542b\u5927\u91cf\u5fae\u670d\u52a1\u76f8\u5173\u6846\u67b6\u53ca\u5de5\u5177","keywords":["Go","Eagle","Toolkit","Framework","Microservices","HTTP"],"slug":"/deployment/app-deploy"},"sidebar":"docs","previous":{"title":"jaeger\u73af\u5883\u90e8\u7f72","permalink":"/docs/deployment/jaeger-deploy"},"next":{"title":"\u90e8\u7f72\u5230k8s\u96c6\u7fa4","permalink":"/docs/deployment/aws-eks-deploy"}}');var c=r(4848),l=r(8453);const o={id:"app-deploy",title:"\u5e94\u7528\u90e8\u7f72",description:"Eagle \u4e00\u5957\u8f7b\u91cf\u7ea7 Go \u5fae\u670d\u52a1\u6846\u67b6\uff0c\u5305\u542b\u5927\u91cf\u5fae\u670d\u52a1\u76f8\u5173\u6846\u67b6\u53ca\u5de5\u5177",keywords:["Go","Eagle","Toolkit","Framework","Microservices","HTTP"],slug:"/deployment/app-deploy"},d=void 0,i={},t=[{value:"\u7f16\u8bd1\u5e76\u8fd0\u884c",id:"\u7f16\u8bd1\u5e76\u8fd0\u884c",level:2},{value:"\u4e8c\u8fdb\u5236\u6587\u4ef6\u90e8\u7f72",id:"\u4e8c\u8fdb\u5236\u6587\u4ef6\u90e8\u7f72",level:2},{value:"\u4f7f\u7528 systemd",id:"\u4f7f\u7528-systemd",level:3},{value:"\u4f7f\u7528 Supervisord",id:"\u4f7f\u7528-supervisord",level:3},{value:"Dockerfile",id:"dockerfile",level:2},{value:"docker-compose",id:"docker-compose",level:2},{value:"Kubernetes",id:"kubernetes",level:2}];function a(e){const s={blockquote:"blockquote",br:"br",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(s.p,{children:["\u652f\u6301\u4e09\u79cd\u5e38\u89c1\u7684\u90e8\u7f72\u65b9\u5f0f\uff1a",(0,c.jsx)(s.code,{children:"Dockerfile"}),"\u3001",(0,c.jsx)(s.code,{children:"docker-compose"}),"\u3001",(0,c.jsx)(s.code,{children:"Kubernetes"})]}),"\n",(0,c.jsx)(s.p,{children:"\u4e0b\u9762\u4ee5\u90e8\u7f72\u7528\u6237\u670d\u52a1\u4e3a\u4f8b\uff1auser-service"}),"\n",(0,c.jsx)(s.h2,{id:"\u7f16\u8bd1\u5e76\u8fd0\u884c",children:"\u7f16\u8bd1\u5e76\u8fd0\u884c"}),"\n",(0,c.jsx)(s.p,{children:"\u5728\u90e8\u7f72\u524d\u9700\u8981\u5bf9go\u670d\u52a1\u8fdb\u884c\u7f16\u8bd1\uff0c\u5177\u4f53\u547d\u4ee4\u5982\u4e0b:"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"make build\n"})}),"\n",(0,c.jsx)(s.p,{children:"\u8fd0\u884c"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"/data/work/user-service/bin/user-service -p 8080 -c /data/work/user-service/conf/config-test.yaml -l /data/logs/user-service\n"})}),"\n",(0,c.jsx)(s.h2,{id:"\u4e8c\u8fdb\u5236\u6587\u4ef6\u90e8\u7f72",children:"\u4e8c\u8fdb\u5236\u6587\u4ef6\u90e8\u7f72"}),"\n",(0,c.jsxs)(s.p,{children:["\u53ef\u4ee5\u4f7f\u7528 scp\u3001rsync\u3001ansible \u6216\u8005 Jenkins \u90e8\u7f72\u5230\u76ee\u6807\u670d\u52a1\u5668\u3002\u4f46\u4e3a\u4e86\u9632\u6b62\u8fdb\u7a0b\u610f\u5916\u9000\u51fa\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,c.jsx)(s.code,{children:"systemd"})," \u6216 ",(0,c.jsx)(s.code,{children:"Supervisord"})," \u8fdb\u884c\u8fdb\u7a0b\u5b88\u62a4\u3002"]}),"\n",(0,c.jsx)(s.p,{children:"\u5728\u6b64\u4e4b\u524d\u5148\u9700\u8981\u521b\u5efa\u7528\u6237\u548c\u7528\u6237\u7ec4:"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"# \u521b\u5efa\u7528\u6237\u7ec4\ngroupadd work\n# \u521b\u5efa\u7528\u6237\u5e76\u6dfb\u52a0\u5230\u7528\u6237\u7ec4\nuseradd -g work work\n# \u8bbe\u7f6e\u7528\u6237\u5bc6\u7801\npasswd work\n\n# \u67e5\u770b\u7528\u6237\nid work\n# \u67e5\u770b\u7528\u6237\u7ec4\ngroups work\n"})}),"\n",(0,c.jsx)(s.p,{children:"\u521b\u5efa\u76f8\u5e94\u7684\u76ee\u5f55"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"mkdir -p /data/work/user-service/bin\nmkdir -p /data/work/user-service/logs\n"})}),"\n",(0,c.jsx)(s.p,{children:"\u6700\u540e\u8fd8\u9700\u8981\u628a\u7a0b\u5e8f\u6267\u884c\u76ee\u5f55\u4fee\u6539\u4e0b\u6240\u5c5e\u7528\u6237\u548c\u7ec4"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"chown -R work:work /data/work\n"})}),"\n",(0,c.jsx)(s.h3,{id:"\u4f7f\u7528-systemd",children:"\u4f7f\u7528 systemd"}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsx)(s.li,{children:"\u521b\u5efa systemd \u670d\u52a1\u5355\u5143\u6587\u4ef6"}),"\n"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"sudo touch /etc/systemd/system/user-service.service\n"})}),"\n",(0,c.jsxs)(s.ol,{start:"2",children:["\n",(0,c.jsx)(s.li,{children:"\u914d\u7f6e\u670d\u52a1\u5355\u5143\u6587\u4ef6"}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["\u5728 ",(0,c.jsx)(s.code,{children:"user-service.service"})," \u4e2d\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9:"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"[Unit]\nDescription=User service\nAfter=network.target\n\n[Service]\nUser=work\nGroup=work\nExecStart=/data/work/user-service/bin/user-service -p 8080 -c /data/work/user-service/conf/config-test.yaml -l /data/logs/user-service\nRestart=always\nRestartSec=10\nStartLimitBurst=5\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,c.jsxs)(s.ol,{start:"3",children:["\n",(0,c.jsx)(s.li,{children:"\u542f\u52a8\u548c\u7ba1\u7406\u670d\u52a1"}),"\n"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"# \u91cd\u8f7d\nsudo systemctl daemon-reload\n\n# \u542f\u52a8\nsudo systemctl start user-service.service\n\n# \u542f\u7528\u670d\u52a1\u5f00\u673a\u81ea\u542f\nsudo systemctl enable user-service.service\n\n# \u67e5\u770b\u670d\u52a1\u72b6\u6001\nsudo systemctl status user-service.service\n\n# \u67e5\u770b\u670d\u52a1\u65e5\u5fd7\njournalctl -u user-service.service\n\n# \u67e5\u770b\u5b9e\u65f6\u65e5\u5fd7\njournalctl -u user-service.service -f\n"})}),"\n",(0,c.jsxs)(s.blockquote,{children:["\n",(0,c.jsx)(s.p,{children:"\u6ce8\u610f\uff1a\u8fd9\u91cc\u4f7f\u7528 user-service.service \u548c user-service \u90fd\u662f\u53ef\u4ee5\u7684"}),"\n"]}),"\n",(0,c.jsx)(s.h3,{id:"\u4f7f\u7528-supervisord",children:"\u4f7f\u7528 Supervisord"}),"\n",(0,c.jsxs)(s.blockquote,{children:["\n",(0,c.jsx)(s.p,{children:"\u8fd9\u91cc\u65e5\u5fd7\u76ee\u5f55\u8bbe\u5b9a\u4e3a /data/logs"}),"\n"]}),"\n",(0,c.jsxs)(s.ol,{children:["\n",(0,c.jsx)(s.li,{children:"\u5b89\u88c5 supervisord"}),"\n"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"sudo apt-get update\nsudo apt-get install supervisor\n"})}),"\n",(0,c.jsxs)(s.ol,{start:"2",children:["\n",(0,c.jsx)(s.li,{children:"\u521b\u5efa supervisord \u914d\u7f6e\u6587\u4ef6"}),"\n"]}),"\n",(0,c.jsxs)(s.p,{children:["\u914d\u7f6e\u6587\u4ef6\u901a\u5e38\u4f4d\u4e8e ",(0,c.jsx)(s.code,{children:"/etc/supervisor/conf.d/"})," \u76ee\u5f55\u4e0b\u3002\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u914d\u7f6e\u6587\u4ef6: ",(0,c.jsx)(s.code,{children:"/etc/supervisor/supervisord.conf"})," \u4e2d\u52a0\u5165\u4ee5\u4e0b\u914d\u7f6e"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-ini",children:"[program:user-service]\nuser=work\n# environment=\ncommand=/data/work/user-service/bin/user-service -p 8080 -c /data/work/user-service/conf/config-test.yaml -l /data/logs/user-service\nautostart=true\nautorestart=true\nstdout_logfile=/data/logs/user-service/supervisor_std.log\nstartsecs = 2\nstartretries = 2\nstdout_logfile_maxbytes=10MB\nstdout_logfile_backups=10\nstderr_logfile=/data/logs/user-service/supervisor_err.log\nstderr_logfile_maxbytes=10MB\nstderr_logfile_backups=10\n"})}),"\n",(0,c.jsxs)(s.ol,{start:"3",children:["\n",(0,c.jsx)(s.li,{children:"\u542f\u52a8\u548c\u7ba1\u7406\u670d\u52a1"}),"\n"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"# \u91cd\u65b0\u52a0\u8f7d\nsudo supervisorctl reread   # \u91cd\u65b0\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\uff0c\u68c0\u67e5\u66f4\u6539\nsudo supervisorctl update   # \u5e94\u7528\u65b0\u7684\u914d\u7f6e\uff0c\u542f\u52a8\u6216\u505c\u6b62\u76f8\u5e94\u7684\u7a0b\u5e8f\n\n# \u542f\u52a8\u670d\u52a1\nsudo supervisorctl start user-service\n\n# \u67e5\u770b\u72b6\u6001\nsudo supervisorctl status user-service\n"})}),"\n",(0,c.jsx)(s.h2,{id:"dockerfile",children:"Dockerfile"}),"\n",(0,c.jsxs)(s.p,{children:[(0,c.jsx)(s.code,{children:"Dockerfile"})," \u6587\u4ef6\u4f4d\u4e8e\u9879\u76ee\u6839\u76ee\u5f55\uff0c\u4e3b\u8981\u7528\u4e8e\u6784\u5efa\u9879\u76ee\u955c\u50cf"]}),"\n",(0,c.jsx)(s.h2,{id:"docker-compose",children:"docker-compose"}),"\n",(0,c.jsxs)(s.p,{children:[(0,c.jsx)(s.code,{children:"docker-compose"})," \u7f16\u6392\u6587\u4ef6\u4f4d\u4e8e\u9879\u76ee ",(0,c.jsx)(s.code,{children:"deploy/docker-compose"})," \u76ee\u5f55\u4e0b",(0,c.jsx)(s.br,{}),"\n","\u672c\u5730\u73af\u5883\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\uff0c\u5176\u4ed6\u73af\u5883\u53ef\u4ee5 copy \u5e76\u8c03\u6574\u540e\u8fd0\u884c"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"docker-compose -f deploy/docker-compose\n"})}),"\n",(0,c.jsx)(s.h2,{id:"kubernetes",children:"Kubernetes"}),"\n",(0,c.jsxs)(s.p,{children:[(0,c.jsx)(s.code,{children:"docker-compose"})," \u7f16\u6392\u6587\u4ef6\u4f4d\u4e8e\u9879\u76ee ",(0,c.jsx)(s.code,{children:"deploy/kubernetes"})," \u76ee\u5f55\u4e0b"]}),"\n",(0,c.jsxs)(s.p,{children:[(0,c.jsx)(s.code,{children:"Kubernetes"})," \u65b9\u5f0f\u57fa\u4e8e ",(0,c.jsx)(s.code,{children:"helm"}),", \u90e8\u7f72\u524d\u53ef\u4ee5\u5c06 ",(0,c.jsx)(s.code,{children:"values.yaml"})," \u62f7\u8d1d\u4e3a\u751f\u4ea7\u73af\u5883\u7684 ",(0,c.jsx)(s.code,{children:"values.prod.yaml"}),"\uff0c"]}),"\n",(0,c.jsxs)(s.p,{children:["\u4f8b\u5982 ",(0,c.jsx)(s.code,{children:"cp values.yaml values.prod.yaml"})]}),"\n",(0,c.jsx)(s.p,{children:"\u6267\u884c\u90e8\u7f72:"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-bash",children:"kubectl apply -Rf deploy/kubernetes\n"})})]})}function p(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,c.jsx)(s,{...e,children:(0,c.jsx)(a,{...e})}):a(e)}},8453:(e,s,r)=>{r.d(s,{R:()=>o,x:()=>d});var n=r(6540);const c={},l=n.createContext(c);function o(e){const s=n.useContext(l);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),n.createElement(l.Provider,{value:s},e.children)}}}]);