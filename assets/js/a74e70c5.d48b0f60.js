"use strict";(self.webpackChunkgo_eagle_org_3=self.webpackChunkgo_eagle_org_3||[]).push([[6843],{7888:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>g});const r=JSON.parse('{"id":"component/registry","title":"\u6ce8\u518c\u4e0e\u53d1\u73b0","description":"\u6ce8\u518c\u4e0e\u53d1\u73b0","source":"@site/docs/component/registry.md","sourceDirName":"component","slug":"/component/registry","permalink":"/docs/component/registry","draft":false,"unlisted":false,"editUrl":"https://github.com/go-eagle/go-eagle.org/edit/main/docs/component/registry.md","tags":[],"version":"current","frontMatter":{"id":"registry","title":"\u6ce8\u518c\u4e0e\u53d1\u73b0","description":"\u6ce8\u518c\u4e0e\u53d1\u73b0","keywords":["Go","Eagle","Registry and discovery","Toolkit","Framework","Microservices","HTTP"],"slug":"/component/registry"},"sidebar":"docs","previous":{"title":"RabbitMQ \u6d88\u606f\u961f\u5217","permalink":"/docs/component/queue/rabbitmq"},"next":{"title":"\u6982\u89c8","permalink":"/docs/component/tracing/overview"}}');var c=t(4848),i=t(8453);const s={id:"registry",title:"\u6ce8\u518c\u4e0e\u53d1\u73b0",description:"\u6ce8\u518c\u4e0e\u53d1\u73b0",keywords:["Go","Eagle","Registry and discovery","Toolkit","Framework","Microservices","HTTP"],slug:"/component/registry"},l=void 0,o={},g=[{value:"\u652f\u6301\u7684\u7ec4\u4ef6",id:"\u652f\u6301\u7684\u7ec4\u4ef6",level:2},{value:"\u670d\u52a1\u6ce8\u518c",id:"\u670d\u52a1\u6ce8\u518c",level:2},{value:"etcd",id:"etcd",level:3},{value:"consul",id:"consul",level:3},{value:"nacos",id:"nacos",level:3},{value:"\u670d\u52a1\u53d1\u73b0",id:"\u670d\u52a1\u53d1\u73b0",level:2},{value:"\u76f4\u8fde\u6a21\u5f0f",id:"\u76f4\u8fde\u6a21\u5f0f",level:3},{value:"etcd",id:"etcd-1",level:3},{value:"consul",id:"consul-1",level:3},{value:"nacos",id:"nacos-1",level:3},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:2}];function a(e){const n={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.p,{children:"\u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0\u57fa\u672c\u662f\u5fae\u670d\u52a1\u5f00\u53d1\u4e2d\u4e0d\u53ef\u6216\u7f3a\u7684\u7ec4\u4ef6\uff0cEagle \u6846\u67b6\u4e5f\u63d0\u4f9b\u4e86\u652f\u6301\u3002"}),"\n",(0,c.jsx)(n.h2,{id:"\u652f\u6301\u7684\u7ec4\u4ef6",children:"\u652f\u6301\u7684\u7ec4\u4ef6"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"etcd"}),"\n",(0,c.jsx)(n.li,{children:"consul"}),"\n",(0,c.jsx)(n.li,{children:"nacos"}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"\u670d\u52a1\u6ce8\u518c",children:"\u670d\u52a1\u6ce8\u518c"}),"\n",(0,c.jsxs)(n.p,{children:["\u5728\u670d\u52a1\u542f\u52a8\u7684\u65f6\u5019\uff0cEagle \u4f1a\u901a\u8fc7 ",(0,c.jsx)(n.code,{children:"eagle.WithRegistry()"})," \u5c06\u5f53\u524d\u5b9e\u4f8b\u6ce8\u518c\u5230\u6ce8\u518c\u4e2d\u5fc3\u91cc\uff0c\u9700\u63d0\u524d\u521b\u5efa\u4e00\u4e2a ",(0,c.jsx)(n.code,{children:"Registry"}),"\uff1b\n\u540c\u7406\uff0c\u5728\u670d\u52a1\u505c\u6389\u7684\u65f6\u5019\uff0c\u4f1a\u4ece\u6ce8\u518c\u4e2d\u5fc3\u91cc\u5254\u9664\u8c03\u3002"]}),"\n",(0,c.jsx)(n.p,{children:"\u4e0d\u540c\u7684\u7ec4\u4ef6\uff0c\u4f7f\u7528\u65b9\u5f0f\u57fa\u672c\u76f8\u540c\uff0c\u5177\u4f53\u5982\u4e0b\u3002"}),"\n",(0,c.jsx)(n.h3,{id:"etcd",children:"etcd"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:'// main.go\nimport (\n  ...\n  "github.com/go-eagle/eagle/pkg/client/etcdclient"\n  "github.com/go-eagle/eagle/pkg/registry/etcd"\n  ...\n)\n\nfunc newApp(cfg *eagle.Config, gs *grpc.Server) *eagle.App {\n\treturn eagle.New(\n\t\teagle.WithName(cfg.Name),\n\t\teagle.WithVersion(cfg.Version),\n\t\teagle.WithLogger(logger.GetLogger()),\n\t\teagle.WithServer(gs),\n\t\teagle.WithRegistry(getEtcdRegistry()),\n\t)\n}\n\nfunc getEtcdRegistry() registry.Registry {\n\tclient, err := etcdclient.New()\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\treturn etcd.New(client.Client)\n}\n'})}),"\n",(0,c.jsx)(n.h3,{id:"consul",children:"consul"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:'// main.go\nimport (\n  ...\n  "github.com/go-eagle/eagle/pkg/client/consulclient"\n  "github.com/go-eagle/eagle/pkg/registry/consul"\n  ...\n)\n\nfunc newApp(cfg *eagle.Config, gs *grpc.Server) *eagle.App {\n\treturn eagle.New(\n\t\teagle.WithName(cfg.Name),\n\t\teagle.WithVersion(cfg.Version),\n\t\teagle.WithLogger(logger.GetLogger()),\n\t\teagle.WithServer(gs,),\n\t\teagle.WithRegistry(getConsulRegistry()),\n\t)\n}\n\nfunc getConsulRegistry() registry.Registry {\n\tclient, err := consulclient.New()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\treturn consul.New(client)\n}\n'})}),"\n",(0,c.jsx)(n.h3,{id:"nacos",children:"nacos"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:'// main.go\nimport (\n  ...\n  "github.com/go-eagle/eagle/pkg/client/nacosclient"\n  "github.com/go-eagle/eagle/pkg/registry/nacos"\n  ...\n)\n\nfunc newApp(cfg *eagle.Config, gs *grpc.Server) *eagle.App {\n\treturn eagle.New(\n\t\teagle.WithName(cfg.Name),\n\t\teagle.WithVersion(cfg.Version),\n\t\teagle.WithLogger(logger.GetLogger()),\n\t\teagle.WithServer(gs,),\n\t\teagle.WithRegistry(getNacosRegistry()),\n\t)\n}\n\nfunc getNacosRegistry() registry.Registry {\n\tclient, err := nacosclient.New()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\treturn nacos.New(client)\n}\n'})}),"\n",(0,c.jsx)(n.h2,{id:"\u670d\u52a1\u53d1\u73b0",children:"\u670d\u52a1\u53d1\u73b0"}),"\n",(0,c.jsxs)(n.p,{children:["\u670d\u52a1\u53d1\u73b0\u7684\u5b9e\u73b0\u4e5f\u6709\u591a\u79cd\u65b9\u5f0f\uff0c\u5047\u5b9a\u9700\u8981\u8fde\u63a5\u7684\u662f\u7528\u6237\u670d\u52a1\uff0c\u670d\u52a1\u540dserviceName\u662f ",(0,c.jsx)(n.code,{children:"user-svc"}),", \u4e3e\u4f8b\u5982\u4e0b\uff1a"]}),"\n",(0,c.jsx)(n.h3,{id:"\u76f4\u8fde\u6a21\u5f0f",children:"\u76f4\u8fde\u6a21\u5f0f"}),"\n",(0,c.jsx)(n.p,{children:"\u652f\u6301\u591a\u4e2a\u8282\u70b9\uff0c\u591a\u4e2a\u7528\u9017\u53f7\u5206\u9694"}),"\n",(0,c.jsxs)(n.blockquote,{children:["\n",(0,c.jsx)(n.p,{children:"\u76f4\u8fde\u6a21\u5f0f\u5c31\u4e0d\u4f1a\u7528\u5230\u670d\u52a1\u540d\u4e86"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:'  ...\n  endpoint := "127.0.0.1:9090"\n\tconn, err := grpc.DialInsecure(\n\t\tctx,\n\t\tgrpc.WithEndpoint(endpoint),\n\t)\n  ...\n'})}),"\n",(0,c.jsx)(n.h3,{id:"etcd-1",children:"etcd"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:'func main() {\n  ...\n  endpoint := "discovery:///user-svc"\n\tconn, err := grpc.DialInsecure(\n\t\tctx,\n\t\tgrpc.WithEndpoint(endpoint),\n\t\tgrpc.WithDiscovery(getEtcdDiscovery()),\n\t)\n  ...\n}\n\nfunc getEtcdDiscovery() registry.Discovery {\n\t// create a etcd register\n\tclient, err := etcdclient.New()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\treturn etcd.New(client.Client)\n}\n'})}),"\n",(0,c.jsx)(n.h3,{id:"consul-1",children:"consul"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:'func main() {\n  ...\n  endpoint := "discovery:///user-svc"\n\tconn, err := grpc.DialInsecure(\n\t\tctx,\n\t\tgrpc.WithEndpoint(endpoint),\n\t\tgrpc.WithDiscovery(getConsulDiscovery()),\n\t)\n  ...\n}\n\nfunc getConsulDiscovery() registry.Discovery {\n\tclient, err := consulclient.New()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\treturn consul.New(client)\n}\n'})}),"\n",(0,c.jsx)(n.h3,{id:"nacos-1",children:"nacos"}),"\n",(0,c.jsxs)(n.p,{children:["\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\uff0cnacos\u548cetcd,consul\u4e0d\u540c\u7684\u662f\uff0c",(0,c.jsx)(n.code,{children:"endpoint"})," \u9700\u8981\u5728\u670d\u52a1\u540d\u540e\u9762\u5e26\u4e0a ",(0,c.jsx)(n.code,{children:".grpc"})," \u540e\u7f00\uff0c\u8fd9\u548c nacos \u6ce8\u518c\u65f6\u7684\u5904\u7406\u6709\u5173\u3002"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-go",children:'func main() {\n  ...\n  endpoint := "discovery:///user-svc.grpc"\n\tconn, err := grpc.DialInsecure(\n\t\tctx,\n\t\tgrpc.WithEndpoint(endpoint),\n\t\tgrpc.WithDiscovery(getNacosDiscovery()),\n\t)\n  ...\n}\n\nfunc getNacosDiscovery() registry.Discovery {\n\tclient, err := nacosclient.New()\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\treturn nacos.New(client)\n}\n'})}),"\n",(0,c.jsx)(n.h2,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,c.jsxs)(n.p,{children:["\u4e0d\u540c\u7ec4\u4ef6\u7684\u914d\u7f6e\u90fd\u96c6\u4e2d\u5230\u4e86\u4e00\u4e2a\u6587\u4ef6\u91cc\uff1a",(0,c.jsx)(n.code,{children:"config/registry.yaml"}),", \u5177\u4f53\u53c2\u6570\u5982\u4e0b"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'# config/registry.yaml\netcd:\n  Endpoints:\n    - "127.0.0.1:2379"\n  ConnectTimeout: 5s\n  BasicAuth:\n  UserName:\n  Password:\n  Secure: false\n  AutoSyncInterval: 1s\n  TTL:\nconsul:\n  Addr: "127.0.0.1:8500"\n  Scheme: http\n  Datacenter:\n  WaitTime: 5s\nnacos:\n  Addr: "127.0.0.1"\n  Port: 8848\n  NamespaceId: public\n  TimeoutMs: 5000\n  LogDir:\n  CacheDir: warn  # debug,info,warn,error, default is info\n'})}),"\n",(0,c.jsxs)(n.blockquote,{children:["\n",(0,c.jsxs)(n.p,{children:["\u6ce8\u610f\uff1aconsul\u7684\u914d\u7f6e\u4e0d\u80fd\u5e26\u6709 ",(0,c.jsx)(n.code,{children:"Namespace"})," \u53c2\u6570, \u6b64\u529f\u80fd\u53ea\u6709\u4f01\u4e1a\u7248\u652f\u6301\uff0c\u5982\u679c\u5f3a\u884c\u5f00\u542f\u4f1a\u62a5\u5982\u4e0b\u9519\u8bef\n",(0,c.jsx)(n.code,{children:'Unexpected response code: 400 (Bad request: Invalid query parameter: "ns" - Namespaces are a Consul Enterprise feature)'})]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"\u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u573a\u666f\u8fdb\u884c\u914d\u7f6e\u3002"})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(a,{...e})}):a(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>l});var r=t(6540);const c={},i=r.createContext(c);function s(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:s(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);