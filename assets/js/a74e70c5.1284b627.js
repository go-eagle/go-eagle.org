"use strict";(self.webpackChunkgo_eagle_org_2=self.webpackChunkgo_eagle_org_2||[]).push([[7552],{3905:function(e,n,r){r.d(n,{Zo:function(){return s},kt:function(){return d}});var t=r(7294);function i(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function c(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function o(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?c(Object(r),!0).forEach((function(n){i(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function a(e,n){if(null==e)return{};var r,t,i=function(e,n){if(null==e)return{};var r,t,i={},c=Object.keys(e);for(t=0;t<c.length;t++)r=c[t],n.indexOf(r)>=0||(i[r]=e[r]);return i}(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(t=0;t<c.length;t++)r=c[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var l=t.createContext({}),g=function(e){var n=t.useContext(l),r=n;return e&&(r="function"==typeof e?e(n):o(o({},n),e)),r},s=function(e){var n=g(e.components);return t.createElement(l.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},u=t.forwardRef((function(e,n){var r=e.components,i=e.mdxType,c=e.originalType,l=e.parentName,s=a(e,["components","mdxType","originalType","parentName"]),u=g(r),d=i,m=u["".concat(l,".").concat(d)]||u[d]||p[d]||c;return r?t.createElement(m,o(o({ref:n},s),{},{components:r})):t.createElement(m,o({ref:n},s))}));function d(e,n){var r=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var c=r.length,o=new Array(c);o[0]=u;var a={};for(var l in n)hasOwnProperty.call(n,l)&&(a[l]=n[l]);a.originalType=e,a.mdxType="string"==typeof e?e:i,o[1]=a;for(var g=2;g<c;g++)o[g]=r[g];return t.createElement.apply(null,o)}return t.createElement.apply(null,r)}u.displayName="MDXCreateElement"},861:function(e,n,r){r.r(n),r.d(n,{contentTitle:function(){return l},default:function(){return u},frontMatter:function(){return a},metadata:function(){return g},toc:function(){return s}});var t=r(7462),i=r(3366),c=(r(7294),r(3905)),o=["components"],a={id:"registry",title:"\u6ce8\u518c\u4e0e\u53d1\u73b0",description:"\u6ce8\u518c\u4e0e\u53d1\u73b0",keywords:["Go","Eagle","Registry and discovery","Toolkit","Framework","Microservices","HTTP"],slug:"/component/registry"},l=void 0,g={unversionedId:"component/registry",id:"component/registry",isDocsHomePage:!1,title:"\u6ce8\u518c\u4e0e\u53d1\u73b0",description:"\u6ce8\u518c\u4e0e\u53d1\u73b0",source:"@site/docs/component/registry.md",sourceDirName:"component",slug:"/component/registry",permalink:"/docs/component/registry",editUrl:"https://github.com/go-eagle/go-eagle.org/edit/main/docs/component/registry.md",version:"current",frontMatter:{id:"registry",title:"\u6ce8\u518c\u4e0e\u53d1\u73b0",description:"\u6ce8\u518c\u4e0e\u53d1\u73b0",keywords:["Go","Eagle","Registry and discovery","Toolkit","Framework","Microservices","HTTP"],slug:"/component/registry"},sidebar:"docs",previous:{title:"RabbitMQ \u6d88\u606f\u961f\u5217",permalink:"/docs/component/queue/rabbitmq"},next:{title:"\u6982\u89c8",permalink:"/docs/component/tracing/overview"}},s=[{value:"\u652f\u6301\u7684\u7ec4\u4ef6",id:"\u652f\u6301\u7684\u7ec4\u4ef6",children:[]},{value:"\u670d\u52a1\u6ce8\u518c",id:"\u670d\u52a1\u6ce8\u518c",children:[{value:"etcd",id:"etcd",children:[]},{value:"consul",id:"consul",children:[]},{value:"nacos",id:"nacos",children:[]}]},{value:"\u670d\u52a1\u53d1\u73b0",id:"\u670d\u52a1\u53d1\u73b0",children:[{value:"\u76f4\u8fde\u6a21\u5f0f",id:"\u76f4\u8fde\u6a21\u5f0f",children:[]},{value:"etcd",id:"etcd-1",children:[]},{value:"consul",id:"consul-1",children:[]},{value:"nacos",id:"nacos-1",children:[]}]},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",children:[]}],p={toc:s};function u(e){var n=e.components,r=(0,i.Z)(e,o);return(0,c.kt)("wrapper",(0,t.Z)({},p,r,{components:n,mdxType:"MDXLayout"}),(0,c.kt)("p",null,"\u670d\u52a1\u6ce8\u518c\u4e0e\u53d1\u73b0\u57fa\u672c\u662f\u5fae\u670d\u52a1\u5f00\u53d1\u4e2d\u4e0d\u53ef\u6216\u7f3a\u7684\u7ec4\u4ef6\uff0cEagle \u6846\u67b6\u4e5f\u63d0\u4f9b\u4e86\u652f\u6301\u3002"),(0,c.kt)("h2",{id:"\u652f\u6301\u7684\u7ec4\u4ef6"},"\u652f\u6301\u7684\u7ec4\u4ef6"),(0,c.kt)("ul",null,(0,c.kt)("li",{parentName:"ul"},"etcd"),(0,c.kt)("li",{parentName:"ul"},"consul"),(0,c.kt)("li",{parentName:"ul"},"nacos")),(0,c.kt)("h2",{id:"\u670d\u52a1\u6ce8\u518c"},"\u670d\u52a1\u6ce8\u518c"),(0,c.kt)("p",null,"\u5728\u670d\u52a1\u542f\u52a8\u7684\u65f6\u5019\uff0cEagle \u4f1a\u901a\u8fc7 ",(0,c.kt)("inlineCode",{parentName:"p"},"eagle.WithRegistry()")," \u5c06\u5f53\u524d\u5b9e\u4f8b\u6ce8\u518c\u5230\u6ce8\u518c\u4e2d\u5fc3\u91cc\uff0c\u9700\u63d0\u524d\u521b\u5efa\u4e00\u4e2a ",(0,c.kt)("inlineCode",{parentName:"p"},"Registry"),"\uff1b\n\u540c\u7406\uff0c\u5728\u670d\u52a1\u505c\u6389\u7684\u65f6\u5019\uff0c\u4f1a\u4ece\u6ce8\u518c\u4e2d\u5fc3\u91cc\u5254\u9664\u8c03\u3002"),(0,c.kt)("p",null,"\u4e0d\u540c\u7684\u7ec4\u4ef6\uff0c\u4f7f\u7528\u65b9\u5f0f\u57fa\u672c\u76f8\u540c\uff0c\u5177\u4f53\u5982\u4e0b\u3002"),(0,c.kt)("h3",{id:"etcd"},"etcd"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-go"},'// main.go\nimport (\n  ...\n  "github.com/go-eagle/eagle/pkg/client/etcdclient"\n  "github.com/go-eagle/eagle/pkg/registry/etcd"\n  ...\n)\n\nfunc newApp(cfg *eagle.Config, gs *grpc.Server) *eagle.App {\n    return eagle.New(\n        eagle.WithName(cfg.Name),\n        eagle.WithVersion(cfg.Version),\n        eagle.WithLogger(logger.GetLogger()),\n        eagle.WithServer(gs),\n        eagle.WithRegistry(getEtcdRegistry()),\n    )\n}\n\nfunc getEtcdRegistry() registry.Registry {\n    client, err := etcdclient.New()\n    if err != nil {\n        log.Fatal(err)\n    }\n    return etcd.New(client.Client)\n}\n')),(0,c.kt)("h3",{id:"consul"},"consul"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-go"},'// main.go\nimport (\n  ...\n  "github.com/go-eagle/eagle/pkg/client/consulclient"\n  "github.com/go-eagle/eagle/pkg/registry/consul"\n  ...\n)\n\nfunc newApp(cfg *eagle.Config, gs *grpc.Server) *eagle.App {\n    return eagle.New(\n        eagle.WithName(cfg.Name),\n        eagle.WithVersion(cfg.Version),\n        eagle.WithLogger(logger.GetLogger()),\n        eagle.WithServer(gs,),\n        eagle.WithRegistry(getConsulRegistry()),\n    )\n}\n\nfunc getConsulRegistry() registry.Registry {\n    client, err := consulclient.New()\n    if err != nil {\n        panic(err)\n    }\n    return consul.New(client)\n}\n')),(0,c.kt)("h3",{id:"nacos"},"nacos"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-go"},'// main.go\nimport (\n  ...\n  "github.com/go-eagle/eagle/pkg/client/nacosclient"\n  "github.com/go-eagle/eagle/pkg/registry/nacos"\n  ...\n)\n\nfunc newApp(cfg *eagle.Config, gs *grpc.Server) *eagle.App {\n    return eagle.New(\n        eagle.WithName(cfg.Name),\n        eagle.WithVersion(cfg.Version),\n        eagle.WithLogger(logger.GetLogger()),\n        eagle.WithServer(gs,),\n        eagle.WithRegistry(getNacosRegistry()),\n    )\n}\n\nfunc getNacosRegistry() registry.Registry {\n    client, err := nacosclient.New()\n    if err != nil {\n        panic(err)\n    }\n    return nacos.New(client)\n}\n')),(0,c.kt)("h2",{id:"\u670d\u52a1\u53d1\u73b0"},"\u670d\u52a1\u53d1\u73b0"),(0,c.kt)("p",null,"\u670d\u52a1\u53d1\u73b0\u7684\u5b9e\u73b0\u4e5f\u6709\u591a\u79cd\u65b9\u5f0f\uff0c\u5047\u5b9a\u9700\u8981\u8fde\u63a5\u7684\u662f\u7528\u6237\u670d\u52a1\uff0c\u670d\u52a1\u540dserviceName\u662f ",(0,c.kt)("inlineCode",{parentName:"p"},"user-svc"),", \u4e3e\u4f8b\u5982\u4e0b\uff1a"),(0,c.kt)("h3",{id:"\u76f4\u8fde\u6a21\u5f0f"},"\u76f4\u8fde\u6a21\u5f0f"),(0,c.kt)("p",null,"\u652f\u6301\u591a\u4e2a\u8282\u70b9\uff0c\u591a\u4e2a\u7528\u9017\u53f7\u5206\u9694"),(0,c.kt)("blockquote",null,(0,c.kt)("p",{parentName:"blockquote"},"\u76f4\u8fde\u6a21\u5f0f\u5c31\u4e0d\u4f1a\u7528\u5230\u670d\u52a1\u540d\u4e86")),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-go"},'  ...\n  endpoint := "127.0.0.1:9090"\n    conn, err := grpc.DialInsecure(\n        ctx,\n        grpc.WithEndpoint(endpoint),\n    )\n  ...\n')),(0,c.kt)("h3",{id:"etcd-1"},"etcd"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-go"},'func main() {\n  ...\n  endpoint := "discovery:///user-svc"\n    conn, err := grpc.DialInsecure(\n        ctx,\n        grpc.WithEndpoint(endpoint),\n        grpc.WithDiscovery(getEtcdDiscovery()),\n    )\n  ...\n}\n\nfunc getEtcdDiscovery() registry.Discovery {\n    // create a etcd register\n    client, err := etcdclient.New()\n    if err != nil {\n        panic(err)\n    }\n    return etcd.New(client.Client)\n}\n')),(0,c.kt)("h3",{id:"consul-1"},"consul"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-go"},'func main() {\n  ...\n  endpoint := "discovery:///user-svc"\n    conn, err := grpc.DialInsecure(\n        ctx,\n        grpc.WithEndpoint(endpoint),\n        grpc.WithDiscovery(getConsulDiscovery()),\n    )\n  ...\n}\n\nfunc getConsulDiscovery() registry.Discovery {\n    client, err := consulclient.New()\n    if err != nil {\n        panic(err)\n    }\n    return consul.New(client)\n}\n')),(0,c.kt)("h3",{id:"nacos-1"},"nacos"),(0,c.kt)("p",null,"\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\uff0cnacos\u548cetcd,consul\u4e0d\u540c\u7684\u662f\uff0c",(0,c.kt)("inlineCode",{parentName:"p"},"endpoint")," \u9700\u8981\u5728\u670d\u52a1\u540d\u540e\u9762\u5e26\u4e0a ",(0,c.kt)("inlineCode",{parentName:"p"},".grpc")," \u540e\u7f00\uff0c\u8fd9\u548c nacos \u6ce8\u518c\u65f6\u7684\u5904\u7406\u6709\u5173\u3002"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-go"},'func main() {\n  ...\n  endpoint := "discovery:///user-svc.grpc"\n    conn, err := grpc.DialInsecure(\n        ctx,\n        grpc.WithEndpoint(endpoint),\n        grpc.WithDiscovery(getNacosDiscovery()),\n    )\n  ...\n}\n\nfunc getNacosDiscovery() registry.Discovery {\n    client, err := nacosclient.New()\n    if err != nil {\n        panic(err)\n    }\n    return nacos.New(client)\n}\n')),(0,c.kt)("h2",{id:"\u914d\u7f6e"},"\u914d\u7f6e"),(0,c.kt)("p",null,"\u4e0d\u540c\u7ec4\u4ef6\u7684\u914d\u7f6e\u90fd\u96c6\u4e2d\u5230\u4e86\u4e00\u4e2a\u6587\u4ef6\u91cc\uff1a",(0,c.kt)("inlineCode",{parentName:"p"},"config/registry.yaml"),", \u5177\u4f53\u53c2\u6570\u5982\u4e0b"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-yaml"},'# config/registry.yaml\netcd:\n  Endpoints:\n    - "127.0.0.1:2379"\n  ConnectTimeout: 5s\n  BasicAuth:\n  UserName:\n  Password:\n  Secure: false\n  AutoSyncInterval: 1s\n  TTL:\nconsul:\n  Addr: "127.0.0.1:8500"\n  Scheme: http\n  Datacenter:\n  WaitTime: 5s\nnacos:\n  Addr: "127.0.0.1"\n  Port: 8848\n  NamespaceId: public\n  TimeoutMs: 5000\n  LogDir:\n  CacheDir: warn  # debug,info,warn,error, default is info\n')),(0,c.kt)("blockquote",null,(0,c.kt)("p",{parentName:"blockquote"},"\u6ce8\u610f\uff1aconsul\u7684\u914d\u7f6e\u4e0d\u80fd\u5e26\u6709 ",(0,c.kt)("inlineCode",{parentName:"p"},"Namespace")," \u53c2\u6570, \u6b64\u529f\u80fd\u53ea\u6709\u4f01\u4e1a\u7248\u652f\u6301\uff0c\u5982\u679c\u5f3a\u884c\u5f00\u542f\u4f1a\u62a5\u5982\u4e0b\u9519\u8bef\n",(0,c.kt)("inlineCode",{parentName:"p"},'Unexpected response code: 400 (Bad request: Invalid query parameter: "ns" - Namespaces are a Consul Enterprise feature)'))),(0,c.kt)("p",null,"\u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u573a\u666f\u8fdb\u884c\u914d\u7f6e\u3002"))}u.isMDXComponent=!0}}]);