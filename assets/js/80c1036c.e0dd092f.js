"use strict";(self.webpackChunkgo_eagle_org_3=self.webpackChunkgo_eagle_org_3||[]).push([[8097],{9653:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>c,toc:()=>p});var t=n(4848),o=n(8453);const s={id:"grpc-guide",title:"\u5f00\u53d1\u6d41\u7a0b - gRPC",description:"Eagle \u4e00\u5957\u8f7b\u91cf\u7ea7 Go \u5fae\u670d\u52a1\u6846\u67b6\uff0c\u5305\u542b\u5927\u91cf\u5fae\u670d\u52a1\u76f8\u5173\u6846\u67b6\u53ca\u5de5\u5177",keywords:["Go","Eagle","gRPC","Toolkit","Framework","Microservices","HTTP"],slug:"/guide/grpc-guide"},i=void 0,c={id:"guide/grpc-guide",title:"\u5f00\u53d1\u6d41\u7a0b - gRPC",description:"Eagle \u4e00\u5957\u8f7b\u91cf\u7ea7 Go \u5fae\u670d\u52a1\u6846\u67b6\uff0c\u5305\u542b\u5927\u91cf\u5fae\u670d\u52a1\u76f8\u5173\u6846\u67b6\u53ca\u5de5\u5177",source:"@site/docs/guide/grpc-guide.md",sourceDirName:"guide",slug:"/guide/grpc-guide",permalink:"/docs/guide/grpc-guide",draft:!1,unlisted:!1,editUrl:"https://github.com/go-eagle/go-eagle.org/edit/main/docs/guide/grpc-guide.md",tags:[],version:"current",frontMatter:{id:"grpc-guide",title:"\u5f00\u53d1\u6d41\u7a0b - gRPC",description:"Eagle \u4e00\u5957\u8f7b\u91cf\u7ea7 Go \u5fae\u670d\u52a1\u6846\u67b6\uff0c\u5305\u542b\u5927\u91cf\u5fae\u670d\u52a1\u76f8\u5173\u6846\u67b6\u53ca\u5de5\u5177",keywords:["Go","Eagle","gRPC","Toolkit","Framework","Microservices","HTTP"],slug:"/guide/grpc-guide"},sidebar:"docs",previous:{title:"\u5f00\u53d1\u89c4\u8303 - RESTful",permalink:"/docs/guide/api-restful"},next:{title:"Swagger \u6587\u6863",permalink:"/docs/guide/swagger-doc"}},l={},p=[{value:"\u5f00\u53d1\u6b65\u9aa4",id:"\u5f00\u53d1\u6b65\u9aa4",level:2},{value:"1\u3001\u751f\u6210proto\u6a21\u677f\u6587\u4ef6",id:"1\u751f\u6210proto\u6a21\u677f\u6587\u4ef6",level:3},{value:"2\u3001\u5b9a\u4e49proto",id:"2\u5b9a\u4e49proto",level:3},{value:"3\u3001\u751f\u6210pb\u6587\u4ef6",id:"3\u751f\u6210pb\u6587\u4ef6",level:3},{value:"4\u3001\u751f\u6210server\u9aa8\u67b6\u4ee3\u7801",id:"4\u751f\u6210server\u9aa8\u67b6\u4ee3\u7801",level:3},{value:"5\u3001\u6ce8\u518c\u670d\u52a1\u5230gRPC Server",id:"5\u6ce8\u518c\u670d\u52a1\u5230grpc-server",level:3},{value:"6\u3001\u5728server\u4e2d\u7f16\u5199\u4e1a\u52a1\u903b\u8f91",id:"6\u5728server\u4e2d\u7f16\u5199\u4e1a\u52a1\u903b\u8f91",level:3},{value:"7\u3001\u542f\u52a8\u670d\u52a1",id:"7\u542f\u52a8\u670d\u52a1",level:3},{value:"8\u3001\u8c03\u8bd5\u63a5\u53e3",id:"8\u8c03\u8bd5\u63a5\u53e3",level:3},{value:"\u5355\u5143\u6d4b\u8bd5",id:"\u5355\u5143\u6d4b\u8bd5",level:2},{value:"\u5b8c\u6574\u6848\u4f8b",id:"\u5b8c\u6574\u6848\u4f8b",level:2},{value:"\u6269\u5c55\u9605\u8bfb",id:"\u6269\u5c55\u9605\u8bfb",level:2},{value:"\u6700\u65b0\u65b9\u5f0f(\u63a8\u8350)",id:"\u6700\u65b0\u65b9\u5f0f\u63a8\u8350",level:3},{value:"\u8f83\u65e9\u65b9\u5f0f(\u5df2\u5e9f\u5f03)",id:"\u8f83\u65e9\u65b9\u5f0f\u5df2\u5e9f\u5f03",level:3},{value:"\u4e3a proto \u589e\u52a0\u6821\u9a8c\u89c4\u5219",id:"\u4e3a-proto-\u589e\u52a0\u6821\u9a8c\u89c4\u5219",level:3},{value:"FAQ",id:"faq",level:2},{value:"Reference",id:"reference",level:2}];function g(e){const r={a:"a",blockquote:"blockquote",br:"br",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"\ud83d\udc49 \u8bb0\u5f55gRPC\u7684\u5f00\u53d1\u6d41\u7a0b\uff0c\u65b9\u4fbf\u540e\u7eed\u7684\u5f00\u53d1"}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"\u5f00\u53d1\u6b65\u9aa4",children:"\u5f00\u53d1\u6b65\u9aa4"}),"\n",(0,t.jsx)(r.h3,{id:"1\u751f\u6210proto\u6a21\u677f\u6587\u4ef6",children:"1\u3001\u751f\u6210proto\u6a21\u677f\u6587\u4ef6"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"eagle proto add api/like/v1/like.proto\n"})}),"\n",(0,t.jsx)(r.p,{children:"\u5185\u5bb9\u5982\u4e0b"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-protobuf",children:'syntax = "proto3";\n\npackage api.like.v1;\n\noption go_package = "github.com/go-microservice/moment-service/api/like/v1;v1";\noption java_multiple_files = true;\noption java_package = "api.like.v1";\n\nservice LikeService {\n    rpc CreateLike (CreateLikeRequest) returns (CreateLikeReply);\n    rpc UpdateLike (UpdateLikeRequest) returns (UpdateLikeReply);\n    rpc DeleteLike (DeleteLikeRequest) returns (DeleteLikeReply);\n    rpc GetLike (GetLikeRequest) returns (GetLikeReply);\n    rpc ListLike (ListLikeRequest) returns (ListLikeReply);\n}\n\nmessage CreateLikeRequest {}\nmessage CreateLikeReply {}\n\nmessage UpdateLikeRequest {}\nmessage UpdateLikeReply {}\n\nmessage DeleteLikeRequest {}\nmessage DeleteLikeReply {}\n\nmessage GetLikeRequest {}\nmessage GetLikeReply {}\n\nmessage ListLikeRequest {}\nmessage ListLikeReply {}\n'})}),"\n",(0,t.jsx)(r.h3,{id:"2\u5b9a\u4e49proto",children:"2\u3001\u5b9a\u4e49proto"}),"\n",(0,t.jsx)(r.p,{children:"\u4e3b\u8981\u662f\u586b\u5145\u4e1a\u52a1\u65b9\u6cd5\u53camessage\u5b9a\u4e49"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:"vim api/like/v1/like.proto\n"})}),"\n",(0,t.jsx)(r.h3,{id:"3\u751f\u6210pb\u6587\u4ef6",children:"3\u3001\u751f\u6210pb\u6587\u4ef6"}),"\n",(0,t.jsx)(r.p,{children:"\u4e1a\u52a1rpc\u65b9\u6cd5\u53camessage\u5b9a\u4e49\u5b8c\uff0c\u5c31\u53ef\u4ee5\u751f\u6210pb\u6587\u4ef6\u4e86\uff0c\u5177\u4f53\u64cd\u4f5c\u5982\u4e0b"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# \u65b9\u5f0f\u4e00\uff1a\u751f\u6210\u6240\u6709proto\nmake grpc\n\n# \u65b9\u5f0f\u4e8c\uff1a\u751f\u6210\u6307\u5b9aproto\u7684pb\u6587\u4ef6\neagle proto client api/like/v1/like.proto\n\n# Output\n# api/like/v1/\nlike.pb.go #\u65b0\u589e\nlike.proto\nlike_grpc.pb.go #\u65b0\u589e\n"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"\u8bf4\u660e"})}),"\n",(0,t.jsx)(r.p,{children:"protocol buffer\u7f16\u8bd1\u5668(protoc)\u751f\u6210\u7684\u4ee3\u7801\u5305\u542b"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["\u6d88\u606f\u5e8f\u5217\u5316\u4ee3\u7801(",(0,t.jsx)(r.code,{children:"*.pb.go"}),")"]}),"\n",(0,t.jsxs)(r.li,{children:["\u5ba2\u6237\u7aef\u4f7f\u7528\u65b9\u6cd5\u8c03\u7528\u7684\u8fdc\u7a0b\u63a5\u53e3\u5b58\u6839\uff08",(0,t.jsx)(r.code,{children:"*_grpc.pb.go"}),"\uff09"]}),"\n",(0,t.jsxs)(r.li,{children:["\u670d\u52a1\u5668\u4ee3\u7801\u5b9e\u73b0\u7684\u62bd\u8c61\u63a5\u53e3\uff08",(0,t.jsx)(r.code,{children:"*_grpc.pb.go"}),"\uff09"]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"4\u751f\u6210server\u9aa8\u67b6\u4ee3\u7801",children:"4\u3001\u751f\u6210server\u9aa8\u67b6\u4ee3\u7801"}),"\n",(0,t.jsxs)(r.p,{children:["\u5b9e\u73b0\u4e86\u4e0a\u4e00\u6b65\u751f\u6210\u7684\u63a5\u53e3(",(0,t.jsx)(r.code,{children:"*_grpc.pb.go"})," \u5185)"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# \u751f\u6210\u9aa8\u67b6\u4ee3\u7801\neagle proto server api/like/v1/like.proto\n\n# \u9ed8\u8ba4\u4f1a\u8f93\u51fa\u5230 internal/service\n# \u5982\u679c\u9700\u8981\u6307\u5b9a\u5230\u5bf9\u5e94\u7684\u76ee\u5f55\uff0c\u53ef\u4ee5\u4f7f\u7528 -t \u53c2\u6570, eg: \n# eagle proto server -t internal/logic\n\n# \u67e5\u770b\ninternal/service/likeservice_grpc.go\n"})}),"\n",(0,t.jsx)(r.h3,{id:"5\u6ce8\u518c\u670d\u52a1\u5230grpc-server",children:"5\u3001\u6ce8\u518c\u670d\u52a1\u5230gRPC Server"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-go",children:'// NewGRPCServer creates a gRPC server\nfunc NewGRPCServer(\n\tcfg *app.ServerConfig,\n\t// \u65b0\u589e\n\tlikeSvc *service.LikeServiceServer, \n) *grpc.Server {\n\n\tgrpcServer := grpc.NewServer(\n\t\tgrpc.Network("tcp"),\n\t\tgrpc.Address(":9090"),\n\t\tgrpc.Timeout(3*time.Second),\n\t)\n\n\t// register biz service\n\t// \u65b0\u589e\n\tlikev1.RegisterLikeServiceServer(grpcServer, likeSvc)\n\n\treturn grpcServer\n}\n'})}),"\n",(0,t.jsx)(r.h3,{id:"6\u5728server\u4e2d\u7f16\u5199\u4e1a\u52a1\u903b\u8f91",children:"6\u3001\u5728server\u4e2d\u7f16\u5199\u4e1a\u52a1\u903b\u8f91"}),"\n",(0,t.jsx)(r.p,{children:"\u8fd9\u91cc\u7f16\u5199\u5177\u4f53\u7684\u4e1a\u52a1\u903b\u8f91"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-go",children:'# vim internal/service/likeservice_grpc.go\n\npackage service\n\nimport (\n\t"context"\n\n\tpb "github.com/go-microservice/moment-service/api/like/v1"\n)\n\nvar (\n\t_ pb.LikeServiceServer = (*LikeServiceServer)(nil)\n)\n\ntype LikeServiceServer struct {\n\tpb.UnimplementedLikeServiceServer\n\n\t// here \u5bfc\u5165\u4f60\u9700\u8981\u7528\u5230\u7684repo\n\tlikeRepo repository.UserLikeRepo\n}\n\nfunc NewLikeServiceServer() *LikeServiceServer {\n\treturn &LikeServiceServer{\n}\n}\n\nfunc (s *LikeServiceServer) CreateLike(ctx context.Context, req *pb.CreateLikeRequest) (*pb.CreateLikeReply, error) {\n\n\treturn &pb.CreateLikeReply{}, nil\n}\nfunc (s *LikeServiceServer) UpdateLike(ctx context.Context, req *pb.UpdateLikeRequest) (*pb.UpdateLikeReply, error) {\n\treturn &pb.UpdateLikeReply{}, nil\n}\nfunc (s *LikeServiceServer) DeleteLike(ctx context.Context, req *pb.DeleteLikeRequest) (*pb.DeleteLikeReply, error) {\n\treturn &pb.DeleteLikeReply{}, nil\n}\nfunc (s *LikeServiceServer) GetLike(ctx context.Context, req *pb.GetLikeRequest) (*pb.GetLikeReply, error) {\n\treturn &pb.GetLikeReply{}, nil\n}\nfunc (s *LikeServiceServer) ListLike(ctx context.Context, req *pb.ListLikeRequest) (*pb.ListLikeReply, error) {\n\treturn &pb.ListLikeReply{}, nil\n}\n'})}),"\n",(0,t.jsx)(r.h3,{id:"7\u542f\u52a8\u670d\u52a1",children:"7\u3001\u542f\u52a8\u670d\u52a1"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# \u5728\u6839\u76ee\u5f55\u4e0b\u8fd0\u884c\ngo run main.go\n"})}),"\n",(0,t.jsx)(r.h3,{id:"8\u8c03\u8bd5\u63a5\u53e3",children:"8\u3001\u8c03\u8bd5\u63a5\u53e3"}),"\n",(0,t.jsxs)(r.p,{children:["\u8c03\u8bd5\u5de5\u5177\uff0c\u8fd9\u91cc\u63a8\u8350\u4f7f\u7528 ",(0,t.jsx)(r.code,{children:"[grpcurl](https://github.com/fullstorydev/grpcurl)"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# \u67e5\u770b\u670d\u52a1\u5217\u8868\ngrpcurl -plaintext localhost:9090 list\n\n# Output\napi.like.v1.LikeService\ngrpc.health.v1.Health\ngrpc.reflection.v1alpha.ServerReflection\n\n# \u8bbf\u95ee\u5217\u8868\ngrpcurl -plaintext -d '{\"user_id\":2}' localhost:9090 api.like.v1.LikeService/ListLike\n"})}),"\n",(0,t.jsx)(r.p,{children:"\u53c2\u6570\u8bf4\u660e"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"-d \u63d0\u4ea4\u7684\u53c2\u6570\uff0c json\u683c\u5f0f"}),"\n",(0,t.jsx)(r.li,{children:"-plaintext \u4f7f\u7528\u7eaf\u6587\u672c\u8fde\u63a5\uff0c\u8df3\u8fc7TLS"}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"\u5176\u4ed6\u5ba2\u6237\u7aef\u8c03\u8bd5\u5de5\u5177"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["\u7c7b\u4f3ccurl\u7684\u8c03\u8bd5\u5de5\u5177 ",(0,t.jsx)(r.a,{href:"https://github.com/fullstorydev/grpcurl",children:"https://github.com/fullstorydev/grpcurl"})]}),"\n",(0,t.jsxs)(r.li,{children:["\u4ea4\u4e92\u5f0f\u7684\u8c03\u8bd5\u5de5\u5177 ",(0,t.jsx)(r.a,{href:"https://github.com/ktr0731/evans",children:"https://github.com/ktr0731/evans"})]}),"\n",(0,t.jsxs)(r.li,{children:["UI\u8c03\u8bd5\u5de5\u5177 ",(0,t.jsx)(r.a,{href:"https://github.com/fullstorydev/grpcui",children:"https://github.com/fullstorydev/grpcui"})]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"\u5355\u5143\u6d4b\u8bd5",children:"\u5355\u5143\u6d4b\u8bd5"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-go",children:'package service\n\nimport (\n\t"context"\n\t"log"\n\t"net"\n\t"testing"\n\t"time"\n\n\t"google.golang.org/grpc"\n\t"google.golang.org/grpc/test/bufconn"\n\n\tpb "github.com/go-microservice/user-service/api/user/v1"\n)\n\nconst (\n\taddr    = ""\n\tbufSize = 1024 * 1024\n)\n\nvar (\n\tlis *bufconn.Listener\n\tsrv *grpc.Server\n)\n\nfunc initGRPCServer() {\n\tlis = bufconn.Listen(bufSize)\n\tsrv = grpc.NewServer()\n\n\tpb.RegisterUserServiceServer(srv, &UserServiceServer{})\n\n\tgo func() {\n\t\tif err := srv.Serve(lis); err != nil {\n\t\t\tlog.Fatalf("srv.Serve, err: %v", err)\n\t\t}\n\t}()\n}\n\nfunc TestUserServiceServer_GetUser(t *testing.T) {\n\tinitGRPCServer()\n\tt.Cleanup(func() {\n\t\tlis.Close()\n\t\tsrv.Stop()\n\t})\n\n\t// test\n\tdialer := func(context.Context, string) (net.Conn, error) {\n\t\treturn lis.Dial()\n\t}\n\n\tctx, cancel := context.WithTimeout(context.Background(), time.Second)\n\tt.Cleanup(func() {\n\t\tcancel()\n\t})\n\n\tconn, err := grpc.DialContext(ctx, addr, grpc.WithContextDialer(dialer), grpc.WithInsecure())\n\tt.Cleanup(func() {\n\t\tconn.Close()\n\t})\n\tif err != nil {\n\t\tlog.Fatalf("grpc.DialContext, err: %v", err)\n\t}\n\n\tclient := pb.NewUserServiceClient(conn)\n\tresp, err := client.GetUser(context.Background(), &pb.GetUserRequest{Id: 1})\n\tif err != nil {\n\t\tt.Fatalf("client.GetUser, err: %v", err)\n\t}\n\n\tif resp.User.Id != 1 {\n\t\tt.Fatalf("Unexpected values: %v", resp.User)\n\t}\n}\n\n'})}),"\n",(0,t.jsx)(r.h2,{id:"\u5b8c\u6574\u6848\u4f8b",children:"\u5b8c\u6574\u6848\u4f8b"}),"\n",(0,t.jsxs)(r.p,{children:["\u5177\u4f53\u4ee3\u7801\u53ef\u4ee5\u53c2\u770b\uff1a",(0,t.jsx)(r.a,{href:"https://github.com/go-microservice/user-service",children:"\u7528\u6237\u670d\u52a1"})]}),"\n",(0,t.jsx)(r.h2,{id:"\u6269\u5c55\u9605\u8bfb",children:"\u6269\u5c55\u9605\u8bfb"}),"\n",(0,t.jsx)(r.p,{children:"\u901a\u8fc7protoc \u751f\u6210pb\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u65b9\u5f0f\uff0c\u4e86\u89e3\u4e0b\u5373\u53ef\uff0c\u89c1\u5230\u540e\u77e5\u9053\u662f\u600e\u4e48\u56de\u4e8b\u3002"}),"\n",(0,t.jsx)(r.h3,{id:"\u6700\u65b0\u65b9\u5f0f\u63a8\u8350",children:"\u6700\u65b0\u65b9\u5f0f(\u63a8\u8350)"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"\u4f7f\u7528\uff1agoogle.golang.org/protobuf"}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"$ protoc --go_out=. --go_opt=paths=source_relative \\\n    --go-grpc_out=. --go-grpc_opt=paths=source_relative \\\n    api/like/v1/like.proto\n"})}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsxs)(r.p,{children:["\u4f1a\u751f\u6210\u4e24\u4e2a\u6587\u4ef6 ",(0,t.jsx)(r.code,{children:"*.pb.go"})," \u548c ",(0,t.jsx)(r.code,{children:"*._grpc.pb.go"}),", \u5206\u522b\u662f\u6d88\u606f\u5e8f\u5217\u5316\u4ee3\u7801\u548c ",(0,t.jsx)(r.code,{children:"gRPC"})," \u4ee3\u7801."]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"\u8f83\u65e9\u65b9\u5f0f\u5df2\u5e9f\u5f03",children:"\u8f83\u65e9\u65b9\u5f0f(\u5df2\u5e9f\u5f03)"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"\u4f7f\u7528\uff1agithub.com/golang/protobuf"}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"$ protoc -I . --go_out=plugins=grpc,paths=source_relative:. api/like/v1/like.proto\n"})}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsxs)(r.p,{children:["\u751f\u6210\u7684 ",(0,t.jsx)(r.code,{children:"*.pb.go"})," \u5305\u542b\u6d88\u606f\u5e8f\u5217\u5316\u4ee3\u7801\u548c ",(0,t.jsx)(r.code,{children:"gRPC"})," \u4ee3\u7801."]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"\u4e3a-proto-\u589e\u52a0\u6821\u9a8c\u89c4\u5219",children:"\u4e3a proto \u589e\u52a0\u6821\u9a8c\u89c4\u5219"}),"\n",(0,t.jsxs)(r.p,{children:["1\u3001\u5728 ",(0,t.jsx)(r.code,{children:"proto"})," \u4e2d\u52a0\u5165\u6821\u9a8c\u89c4\u5219"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'// api/user/v1/user.proto\nsyntax = "proto3";\n\npackage user.v1;\n\nimport "google/protobuf/empty.proto";\nimport "validate/validate.proto";\n...\n// \u5728\u5bf9\u5e94\u7684\u5b57\u6bb5\u4e2d\u52a0\u5165\u6821\u9a8c\u89c4\u5219\nmessage RegisterRequest {\n  string username = 1 [(validate.rules).string.min_len = 5];\n  string email = 2 [(validate.rules).string.email = true];\n  string password = 3 [(validate.rules).string.min_len = 6];\n}\n...\n'})}),"\n",(0,t.jsx)(r.p,{children:"2\u3001\u5728 server \u4e2d\u542f\u7528\u6821\u9a8c"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-go",children:'...\nfunc (s *UserServiceServer) Register(ctx context.Context, req *pb.RegisterRequest) (*pb.RegisterReply, error) {\n\terr := req.Validate()\n\tif err != nil {\n\t\treturn nil, ecode.ErrInvalidArgument.WithDetails(errcode.NewDetails(map[string]interface{}{\n\t\t\t"msg": err.Error(),\n\t\t})).Status(req).Err()\n\t}\n\t...\n}\n'})}),"\n",(0,t.jsx)(r.p,{children:"\u6bd4\u5982\u90ae\u7bb1\u9519\u8bef\u4f1a\u8fd4\u56de:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"0: {\n\ttype_url: type.googleapis.com/user.v1.RegisterRequest\n\tvalue: Cgd1c2VyMDAxEgl0ZXN0ZW1haWwaBjEyMzQ1Ng==\n},\n1: {\n\ttype_url: type.googleapis.com/google.protobuf.Struct\n\tvalue: CngKA21zZxJxGm9pbnZhbGlkIFJlZ2lzdGVyUmVxdWVzdC5FbWFpbDogdmFsdWUgbXVzdCBiZSBhIHZhbGlkIGVtYWlsIGFkZHJlc3MgfCBjYXVzZWQgYnk6IG1haWw6IG1pc3NpbmcgJ0AnIG9yIGFuZ2xlLWFkZHI=\n}\n"})}),"\n",(0,t.jsxs)(r.p,{children:["\u6ce8\u610f\uff1a\u8fd4\u56de\u7684\u9519\u8bef\u4fe1\u606f\u662f\u7ecf\u8fc7\u5e8f\u5217\u5316\u7684 ",(0,t.jsx)(r.code,{children:"Google Protocol Buffers (protobuf)"})," \u683c\u5f0f\uff0c\u8ba9\u6211\u4eec\u5206\u6790\u5176\u4e2d\u7684\u6bcf\u4e2a\u5b57\u6bb5\uff1a"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"type_url"}),"\uff1a"]}),"\n",(0,t.jsxs)(r.p,{children:["\u8fd9\u4e2a\u5b57\u6bb5\u8868\u793a\u5e8f\u5217\u5316\u540e\u7684\u6570\u636e\u6240\u5c5e\u7684\u7c7b\u578b\uff0c\u5373\u6570\u636e\u7684\u7c7b\u578b\u4fe1\u606f\u3002\n\u5728\u8fd9\u91cc\uff0c",(0,t.jsx)(r.code,{children:"type.googleapis.com/user.v1.RegisterRequest"})," \u8868\u793a\u5e8f\u5217\u5316\u7684\u6570\u636e\u5c5e\u4e8e user.v1 \u5305\u4e2d\u7684 RegisterRequest \u7ed3\u6784\u4f53\u7c7b\u578b\u3002"]}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"value"}),"\uff1a\n\u8fd9\u4e2a\u5b57\u6bb5\u5305\u542b\u5e8f\u5217\u5316\u540e\u7684\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u7ecf\u8fc7 Base64 \u7f16\u7801\u3002\n\u5728\u8fd9\u91cc\uff0c",(0,t.jsx)(r.code,{children:"CgYxMTExMTESCHN1cGVyMDA3GgYxMTExMTE="})," \u662f\u7ecf\u8fc7 Base64 \u7f16\u7801\u7684\u5e8f\u5217\u5316\u6570\u636e\uff0c\u901a\u8fc7\u89e3\u7801\u53ef\u4ee5\u5f97\u5230\u8be6\u7ec6\u7684\u9519\u8bef\u4fe1\u606f\u5b57\u7b26\u4e32\u3002"]}),"\n",(0,t.jsx)(r.h2,{id:"faq",children:"FAQ"}),"\n",(0,t.jsxs)(r.p,{children:["Q1: ",(0,t.jsx)(r.code,{children:"github.com/golang/protobuf"})," \u548c ",(0,t.jsx)(r.code,{children:"google.golang.org/protobuf"})," \u6709\u4ec0\u4e48\u533a\u522b\uff1f",(0,t.jsx)(r.br,{}),"\n","A: ",(0,t.jsx)(r.code,{children:"github.com/golang/protobuf"})," \u6a21\u5757\u662f\u539f\u59cb\u7684 Go protocol buffer API\u3002",(0,t.jsx)(r.br,{}),"\n",(0,t.jsx)(r.code,{children:"google.golang.org/protobuf"})," \u6a21\u5757\u662f\u6b64 API \u7684\u66f4\u65b0\u7248\u672c\uff0c\u65e8\u5728\u7b80\u5316\u3001\u6613\u7528\u548c\u5b89\u5168\uff0c\u66f4\u65b0\u540e\u7684 API \u7684\u65d7\u8230\u529f\u80fd\u662f\u652f\u6301\u53cd\u5c04\u4ee5\u53ca\u5c06\u9762\u5411\u7528\u6237\u7684 API \u4e0e\u5e95\u5c42\u5b9e\u73b0\u5206\u79bb\u3002"]}),"\n",(0,t.jsxs)(r.p,{children:["Q2: \u5982\u679c\u901a\u8fc7proto\u751f\u6210\u7684\u7ed3\u6784\u4f53\u5728\u8bbf\u95eehttp\u63a5\u53e3\u65f6\uff0c\u5f53\u8fd4\u56de\u503c\u4e3a\u96f6\u503c\u7684\u65f6\u5019\uff0cjson\u5b57\u6bb5\u4e0d\u663e\u793a\u5982\u4f55\u5904\u7406\uff1f",(0,t.jsx)(r.br,{}),"\n","A: \u53ef\u4ee5\u5728message\u7684\u5b57\u6bb5\u4e2d\u52a0\u5165 ",(0,t.jsx)(r.code,{children:"gogoproto.jsontag"}),"\uff0c \u793a\u4f8b\u5982\u4e0b\uff1a"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-proto",children:'import "gogo/protobuf/gogo.proto";\n\nmessage ListPostReply {\n\trepeated Post items = 1 [(gogoproto.jsontag) = "items"];\n\tint64 count = 2 [(gogoproto.jsontag) = "count"];\n\tbool has_more = 3 [(gogoproto.jsontag) = "has_more"];\n\tstring last_id = 4 [(gogoproto.jsontag) = "last_id"];\n}\n'})}),"\n",(0,t.jsxs)(r.p,{children:["Q3: \u5982\u4f55\u63a5\u6536uri\u4e2d\u6216\u8005form\u91cc\u7684\u53c2\u6570\uff1f",(0,t.jsx)(r.br,{}),"\n","A: \u53ef\u4ee5\u4f7f\u7528 ",(0,t.jsx)(r.code,{children:"gogoproto.moretags"}),"\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-proto",children:'import "gogo/protobuf/gogo.proto";\n\n// \u63a5\u6536uri\u4e2d\u7684\u53c2\u6570\nmessage GetPostRequest {\n\tstring id = 1 [(gogoproto.moretags) = \'uri:"id"\'];\n}\n\n// \u63a5\u6536form\u91cc\u7684\u53c2\u6570\nmessage ListPostRequest {\n\tint64 last_id = 1 [(gogoproto.moretags) = \'form:"last_id"\'];\n\tint32 limit = 2 [(gogoproto.moretags) = \'form:"limit"\'];\n}\n'})}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.a,{href:"https://developers.google.com/protocol-buffers/docs/reference/go/faq",children:"https://developers.google.com/protocol-buffers/docs/reference/go/faq"})}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"reference",children:"Reference"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://grpc.io/docs/languages/go/quickstart/",children:"https://grpc.io/docs/languages/go/quickstart/"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://developers.google.com/protocol-buffers/docs/proto3",children:"https://developers.google.com/protocol-buffers/docs/proto3"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://grpc.io/docs/guides/error/",children:"https://grpc.io/docs/guides/error/"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://github.com/avinassh/grpc-errors/blob/master/go/client.go",children:"https://github.com/avinassh/grpc-errors/blob/master/go/client.go"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://stackoverflow.com/questions/64828054/differences-between-protoc-gen-go-and-protoc-gen-go-grpc",children:"https://stackoverflow.com/questions/64828054/differences-between-protoc-gen-go-and-protoc-gen-go-grpc"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://jbrandhorst.com/post/grpc-errors/",children:"https://jbrandhorst.com/post/grpc-errors/"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://godoc.org/google.golang.org/genproto/googleapis/rpc/errdetails",children:"https://godoc.org/google.golang.org/genproto/googleapis/rpc/errdetails"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://cloud.google.com/apis/design/errors",children:"https://cloud.google.com/apis/design/errors"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://github.com/grpc/grpc/blob/master/doc/health-checking.md",children:"https://github.com/grpc/grpc/blob/master/doc/health-checking.md"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://eddycjy.com/posts/where-is-proto/",children:"https://eddycjy.com/posts/where-is-proto/"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://stackoverflow.com/questions/52969205/how-to-assert-grpc-error-codes-client-side-in-go",children:"https://stackoverflow.com/questions/52969205/how-to-assert-grpc-error-codes-client-side-in-go"})}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"https://google.aip.dev/",children:"https://google.aip.dev/"})," \ud83d\udc4d\ud83c\udffb"]}),"\n"]})]})}function d(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(g,{...e})}):g(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>i,x:()=>c});var t=n(6540);const o={},s=t.createContext(o);function i(e){const r=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(s.Provider,{value:r},e.children)}}}]);